<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wall - Responsive Studio</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Roboto+Mono:wght@400;600&display=swap');

        :root {
            --neon-blue: #00f3ff;
            --neon-green: #39ff14;
            --neon-red: #ff003c;
            --gold: #ffd700;
            --bg-dark: #050505;
            --panel-bg: rgba(15, 20, 30, 0.95);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            display: flex;
        }

        #app-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        #game-stage {
            flex: 1; /* Takes all remaining space */
            position: relative;
            background: radial-gradient(circle at center, #1a2233 0%, #000 90%);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-right: 2px solid #333;
        }

        canvas {
            display: block;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
        }


        #control-panel {
            width: 380px;
            min-width: 350px;
            background: var(--panel-bg);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
            z-index: 10;
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
            overflow-y: auto; 
        }

        h1 {
            text-align: center;
            color: white;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin: 0 0 10px 0;
            font-size: 28px;
            text-shadow: 0 0 15px var(--neon-blue);
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .bank-display {
            background: black;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: inset 0 0 20px rgba(0, 243, 255, 0.05);
            flex-shrink: 0;
        }
        .bank-label { font-size: 11px; color: #888; letter-spacing: 2px; font-family: 'Roboto Mono', monospace; }
        .bank-value { 
            font-size: 42px; font-weight: 900; color: white; margin-top: 5px;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .control-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            flex-shrink: 0;
        }
        .box-title {
            font-size: 12px; color: var(--neon-blue); margin-bottom: 10px; display: flex; justify-content: space-between;
        }

        .slots-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .slot-btn {
            background: #111; border: 1px solid #444; color: #666;
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 14px;
            transition: all 0.2s;
        }
        .slot-btn:hover { background: #222; color: white; border-color: #888; }
        .slot-btn.active {
            background: white; color: black; box-shadow: 0 0 10px white; border-color: white;
        }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn {
            padding: 20px; border: none; font-family: 'Orbitron', sans-serif;
            font-weight: 900; font-size: 16px; text-transform: uppercase;
            cursor: pointer; opacity: 0.5; pointer-events: none; border-radius: 4px;
            transition: all 0.2s;
        }
        .action-btn.ready { opacity: 1; pointer-events: all; }
        
        .btn-green { background: linear-gradient(to bottom, #006600, #004400); color: #8f8; border-bottom: 3px solid #0f0; }
        .btn-green:hover { box-shadow: 0 0 15px var(--neon-green); filter: brightness(1.2); }
        
        .btn-red { background: linear-gradient(to bottom, #660000, #440000); color: #f88; border-bottom: 3px solid #f00; }
        .btn-red:hover { box-shadow: 0 0 15px var(--neon-red); filter: brightness(1.2); }

        .log-container {
            flex-grow: 1; 
            background: rgba(0,0,0,0.3);
            border: 1px solid #222;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 11px;
            overflow-y: auto;
            min-height: 100px;
        }
        .log-item { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2px; }
        .plus { color: var(--neon-green); }
        .minus { color: var(--neon-red); }
        #status-bar {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 20px;
            border: 1px solid #444; color: white; font-size: 14px; letter-spacing: 1px;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
        }
        #status-bar.show { opacity: 1; }

    </style>
</head>
<body>

<div id="app-container">
    
    <!-- GAME STAGE -->
    <div id="game-stage">
        <div id="status-bar">STATUS MESSAGE</div>
        <canvas id="wallCanvas"></canvas>
    </div>

    <div id="control-panel">
        <h1>The Wall</h1>
        
        <div class="bank-display">
            <div class="bank-label">CURRENT BANK</div>
            <div class="bank-value" id="bankDisplay">$0</div>
        </div>


        <div class="control-box">
            <div class="box-title">
                <span>1. SELECT ZONES</span>
                <span id="ballCount">0/3</span>
            </div>
            <div class="slots-grid" id="slotsContainer">
            
            </div>
        </div>

        <div class="control-box">
            <div class="box-title">2. REVEAL</div>
            <div class="btn-grid">
                <button class="action-btn btn-green" id="btnGreen" onclick="triggerDrop('green')">CORRECT</button>
                <button class="action-btn btn-red" id="btnRed" onclick="triggerDrop('red')">WRONG</button>
            </div>
        </div>

        <div class="log-container" id="gameLog">
            <div style="color:#555; text-align:center;">--- Transaction Log ---</div>
        </div>

        <button onclick="resetGame()" style="background:transparent; border:1px solid #333; color:#666; padding:10px; cursor:pointer;">RESET BOARD</button>
    </div>

</div>

<script>
    const canvas = document.getElementById('wallCanvas');
    const ctx = canvas.getContext('2d');
    const stage = document.getElementById('game-stage');

    const V_WIDTH = 1000;
    const V_HEIGHT = 1400; 
    let scale = 1;

    // --- GAME CONSTANTS ---
    const GRAVITY = 0.4; // Slightly stronger for snappy feel
    const FRICTION = 0.98;
    const RESTITUTION = 0.6;
    const DROP_ZONES = 7;
    const BIN_VALUES = [1, 500, 100, 2000, 10, 5000, 100, 10000, 1, 25000, 10, 50000, 100, 100000, 1];

    // --- STATE ---
    let balls = [];
    let pins = [];
    let bins = [];
    let zones = [];
    let particles = [];
    let floats = [];
    let totalScore = 0;

    // --- CLASSES ---
    class Vector {
        constructor(x, y) { this.x = x; this.y = y; }
        add(v) { return new Vector(this.x + v.x, this.y + v.y); }
        sub(v) { return new Vector(this.x - v.x, this.y - v.y); }
        mult(n) { return new Vector(this.x * n, this.y * n); }
        mag() { return Math.sqrt(this.x * this.x + this.y * this.y); }
        normalize() { 
            let m = this.mag(); 
            return (m === 0) ? new Vector(0,0) : new Vector(this.x/m, this.y/m); 
        }
        dot(v) { return this.x * v.x + this.y * v.y; }
    }

    class Ball {
        constructor(x, y, zoneId) {
            this.pos = new Vector(x, y);
            this.vel = new Vector(0, 0);
            this.radius = 14; // Virtual pixels
            this.active = true;
            this.hovering = true;
            this.zoneId = zoneId;
            this.color = 'white';
        }

        update() {
            if (!this.active || this.hovering) return;

            // Physics
            this.vel.y += GRAVITY;
            this.vel = this.vel.mult(FRICTION);
            this.pos = this.pos.add(this.vel);

            // Wall Collisions (Virtual Coordinates)
            if (this.pos.x < this.radius) {
                this.pos.x = this.radius;
                this.vel.x *= -0.6;
            }
            if (this.pos.x > V_WIDTH - this.radius) {
                this.pos.x = V_WIDTH - this.radius;
                this.vel.x *= -0.6;
            }

            // Pin Collisions
            for(let pin of pins) {
                let dx = this.pos.x - pin.x;
                let dy = this.pos.y - pin.y;
                let distSq = dx*dx + dy*dy;
                let minDist = this.radius + pin.r;

                if (distSq < minDist * minDist) {
                    let dist = Math.sqrt(distSq);
                    let normal = new Vector(dx/dist, dy/dist);
                    
                    // Chaos Factor
                    let chaos = new Vector((Math.random()-0.5)*1.5, (Math.random()-0.5)*1.5);
                    
                    let dot = this.vel.dot(normal);
                    let reflect = this.vel.sub(normal.mult(2 * dot));
                    
                    this.vel = reflect.add(chaos).mult(RESTITUTION);
                    
                    // Push out
                    let overlap = minDist - dist;
                    this.pos = this.pos.add(normal.mult(overlap));
                }
            }

            // Bin Collisions
            if (this.pos.y > V_HEIGHT - 120) { 
                for(let bin of bins) {
                    if (this.pos.x > bin.x && this.pos.x < bin.x + bin.w) {
                        if (this.pos.y > bin.y + 40) { 
                            this.finish(bin);
                        }
                    }
                }
            }
        }

        finish(bin) {
            this.active = false;
            this.pos.x = bin.x + bin.w/2;
            this.pos.y = bin.y + bin.h/2;
            
            handleScore(bin.value, this.color, this.pos.x, this.pos.y);
        }

        draw(ctx) {
            ctx.beginPath();
            ctx.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI*2);
            
            let fill = '#fff';
            let glow = 'rgba(255,255,255,0.5)';
            if (this.color === 'green') { fill = '#39ff14'; glow = '#39ff14'; }
            if (this.color === 'red') { fill = '#ff003c'; glow = '#ff003c'; }

            ctx.fillStyle = fill;
            ctx.shadowBlur = 20;
            ctx.shadowColor = glow;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Highlight
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.beginPath();
            ctx.arc(this.pos.x - 4, this.pos.y - 4, 4, 0, Math.PI*2);
            ctx.fill();
        }
    }

    // --- CORE LOGIC ---

    function resize() {
        // 1. Get container dimensions
        const cw = stage.clientWidth;
        const ch = stage.clientHeight;
        const scaleX = cw / V_WIDTH;
        const scaleY = ch / V_HEIGHT;
        
        // Use the smaller scale to ensure it fits (contain)
        scale = Math.min(scaleX, scaleY) * 0.95; 

        // 3. Set actual canvas pixel size
        canvas.width = V_WIDTH * scale;
        canvas.height = V_HEIGHT * scale;

    }

    function initBoard() {
        pins = [];
        bins = [];
        zones = [];

        const zoneW = V_WIDTH / DROP_ZONES;
        for(let i=0; i<DROP_ZONES; i++) {
            zones.push({
                x: i * zoneW,
                y: 20,
                w: zoneW,
                h: 80,
                id: i
            });
        }

        const rows = 16;
        const cols = 15;
        const startY = 150;
        const endY = V_HEIGHT - 150;
        const usableW = V_WIDTH - 80; 
        const stepX = usableW / (cols - 1);
        const stepY = (endY - startY) / rows;

        for(let r=0; r<rows; r++) {
            let count = (r % 2 === 0) ? cols : cols - 1;
            let xOff = (r % 2 === 0) ? 40 : 40 + stepX/2;
            
            for(let c=0; c<count; c++) {
                pins.push({
                    x: xOff + (c * stepX),
                    y: startY + (r * stepY),
                    r: 5
                });
            }
        }

        const binW = V_WIDTH / 15;
        for(let i=0; i<15; i++) {
            bins.push({
                x: i * binW,
                y: V_HEIGHT - 120,
                w: binW,
                h: 120,
                value: BIN_VALUES[i]
            });
        }
    }

    function handleScore(val, type, x, y) {
        let amt = (type === 'green') ? val : -val;
        totalScore += amt;
        
        const disp = document.getElementById('bankDisplay');
        disp.innerText = (totalScore < 0 ? "-" : "") + "$" + Math.abs(totalScore).toLocaleString();
        disp.style.color = totalScore < 0 ? "#ff003c" : "white";

        const log = document.getElementById('gameLog');
        const item = document.createElement('div');
        item.className = 'log-item';
        let sym = amt >= 0 ? "+" : "-";
        let col = amt >= 0 ? "plus" : "minus";
        item.innerHTML = `<span class="${col}">${sym}$${val.toLocaleString()}</span> <span style="color:#666; float:right;">Bin ${bins.findIndex(b=>Math.abs(b.x + b.w/2 - x) < 10) + 1}</span>`;
        log.prepend(item);

        floats.push({
            txt: sym + "$" + shortNum(val),
            x: x, y: y - 50, life: 1.0, 
            color: amt >= 0 ? "#39ff14" : "#ff003c"
        });
        spawnParticles(x, y, type);

        if (balls.every(b => !b.active)) {
            setTimeout(() => {
                balls = [];
                updateUI();
                showStatus("ROUND COMPLETE - PLACE BALLS");
            }, 1500);
        }
    }

    // --- GAMEPLAY CONTROLS 

    function toggleZone(id) {
        if (balls.some(b => !b.hovering)) return; 

        let existing = balls.findIndex(b => b.zoneId === id);
        if (existing !== -1) {
            balls.splice(existing, 1);
        } else {
            if (balls.length < 3) {
                let z = zones[id];
                balls.push(new Ball(z.x + z.w/2, z.y + z.h/2, id));
            }
        }
        updateUI();
    }

    function triggerDrop(type) {
        if (balls.length === 0 || balls.some(b => !b.hovering)) return;

        showStatus(type === 'green' ? "CORRECT ANSWER!" : "WRONG ANSWER!");
        
        balls.forEach((b, i) => {
            b.color = type;
            setTimeout(() => {
                b.hovering = false;
                b.vel.x = (Math.random()-0.5) * 5;
                b.vel.y = 2;
            }, i * 300);
        });

        updateUI();
    }

    function resetGame() {
        totalScore = 0;
        balls = [];
        floats = [];
        particles = [];
        document.getElementById('bankDisplay').innerText = "$0";
        document.getElementById('bankDisplay').style.color = "white";
        document.getElementById('gameLog').innerHTML = '<div style="color:#555; text-align:center;">--- Transaction Log ---</div>';
        showStatus("GAME RESET");
        updateUI();
    }


    function updateUI() {
        // Slots
        for(let i=0; i<DROP_ZONES; i++) {
            let btn = document.getElementById('slot-'+i);
            if(balls.some(b => b.zoneId === i)) btn.classList.add('active');
            else btn.classList.remove('active');
        }
        document.getElementById('ballCount').innerText = balls.length + "/3";

        // Buttons
        const locked = balls.length === 0 || balls.some(b => !b.hovering);
        document.getElementById('btnGreen').className = 'action-btn btn-green ' + (locked?'':'ready');
        document.getElementById('btnRed').className = 'action-btn btn-red ' + (locked?'':'ready');
    }

    function generateControls() {
        const c = document.getElementById('slotsContainer');
        c.innerHTML = '';
        for(let i=0; i<DROP_ZONES; i++) {
            let b = document.createElement('div');
            b.className = 'slot-btn';
            b.innerText = i+1;
            b.id = 'slot-'+i;
            b.onclick = () => toggleZone(i);
            c.appendChild(b);
        }
    }

    function showStatus(msg) {
        const el = document.getElementById('status-bar');
        el.innerText = msg;
        el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 2000);
    }


    function loop() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        
        ctx.save();
        const offsetX = (canvas.width - V_WIDTH * scale) / 2;
        const offsetY = (canvas.height - V_HEIGHT * scale) / 2;
        ctx.translate(offsetX, offsetY);
        ctx.scale(scale, scale);

        bins.forEach(b => {
            let isGold = b.value >= 100000;
            let grad = ctx.createLinearGradient(0, b.y, 0, b.y + b.h);
            grad.addColorStop(0, isGold ? '#ffd700' : '#333');
            grad.addColorStop(1, isGold ? '#b8860b' : '#111');
            
            ctx.fillStyle = grad;
            ctx.fillRect(b.x, b.y, b.w, b.h);
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.strokeRect(b.x, b.y, b.w, b.h);

            ctx.fillStyle = isGold ? 'black' : 'white';
            ctx.font = 'bold 24px Roboto Mono';
            ctx.textAlign = 'center';
            ctx.fillText("$"+shortNum(b.value), b.x + b.w/2, b.y + 70);
        });

        // 2. Pins
        ctx.fillStyle = 'white';
        ctx.shadowBlur = 10;
        ctx.shadowColor = 'white';
        pins.forEach(p => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            ctx.fill();
        });
        ctx.shadowBlur = 0;

        zones.forEach(z => {
            ctx.strokeStyle = 'rgba(0, 243, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(z.x+5, z.y, z.w-10, z.h);
            
            ctx.fillStyle = 'var(--neon-blue)';
            ctx.font = 'bold 30px Orbitron';
            ctx.fillText(z.id + 1, z.x + z.w/2, z.y + 50);
        });

        balls.forEach(b => {
            b.update();
            b.draw(ctx);
        });

        drawFX(ctx);

        ctx.restore();
        requestAnimationFrame(loop);
    }

    function drawFX(ctx) {
        // Particles
        for(let i=particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            ctx.globalAlpha = Math.max(0, p.life);
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;
            if (p.life <= 0) particles.splice(i, 1);
        }

        // Float Text
        for(let i=floats.length-1; i>=0; i--) {
            let f = floats[i];
            f.y -= 2; f.life -= 0.015;
            ctx.globalAlpha = Math.max(0, f.life);
            ctx.fillStyle = f.color;
            ctx.font = '900 40px Orbitron';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 4;
            ctx.strokeText(f.txt, f.x, f.y);
            ctx.fillText(f.txt, f.x, f.y);
            ctx.globalAlpha = 1;
            if (f.life <= 0) floats.splice(i, 1);
        }
    }

    function spawnParticles(x, y, type) {
        let c = type === 'green' ? '#39ff14' : '#ff003c';
        for(let i=0; i<30; i++) {
            particles.push({
                x:x, y:y,
                vx:(Math.random()-0.5)*15,
                vy:(Math.random()-0.5)*15,
                life: 1.0, color: c
            });
        }
    }

    function shortNum(n) {
        if(n >= 1000000) return (n/1000000)+"M";
        if(n >= 1000) return (n/1000)+"k";
        return n;
    }

    initBoard();
    generateControls();
    resize();
    window.addEventListener('resize', resize);
    
    loop();

</script>
</body>
</html>